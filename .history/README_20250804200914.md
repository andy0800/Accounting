# نظام إدارة التأشيرات والمحاسبة

نظام شامل لإدارة التأشيرات والمحاسبة باللغة العربية، مصمم خصيصاً لشركة فرصتكم.

## المميزات الرئيسية

### 1. إدارة التأشيرات
- **عملية شراء التأشيرة**: 5 مراحل منظمة (أ، ب، ج، د، هـ)
- **تتبع المصروفات**: تسجيل المصروفات لكل مرحلة
- **إدارة الحالات**: نشطة، متاحة للبيع، مباعة، ملغاة
- **خيار الاستبدال**: استبدال التأشيرة مرة واحدة مع تتبع التكاليف
- **المواعيد النهائية**: إلغاء تلقائي عند تجاوز الموعد

### 2. إدارة السكرتارية
- **حسابات منفصلة**: لكل سكرتير حساب خاص
- **رموز تلقائية**: توليد رمز من حرفين من الاسم
- **تتبع الأرباح والدين**: حساب دقيق للأرباح والديون
- **إحصائيات مفصلة**: لكل سكرتير

### 3. النظام المحاسبي
- **حساب الشركة**: تتبع إجمالي المصروفات والأرباح
- **تقسيم الأرباح**: بين الشركة والسكرتير حسب النسبة المحددة
- **تقارير مالية**: شهري وسنوي
- **إحصائيات متقدمة**: متوسط الربح، إجمالي التأشيرات، إلخ

### 4. التصدير والتقارير
- **تصدير Excel**: جميع البيانات بصيغة منظمة
- **تقارير مفصلة**: للشركة والسكرتارية والتأشيرات
- **رموز مرجعية**: نظام ترميز منظم للتأشيرات

## المتطلبات التقنية

- Node.js (الإصدار 16 أو أحدث)
- MongoDB (الإصدار 4.4 أو أحدث)
- npm أو yarn

## التثبيت والتشغيل

### 1. استنساخ المشروع
```bash
git clone <رابط-المشروع>
cd نظام-إدارة-التأشيرات
```

### 2. تثبيت التبعيات
```bash
# تثبيت جميع التبعيات
npm run install-all
```

### 3. إعداد قاعدة البيانات
```bash
# تأكد من تشغيل MongoDB
mongod
```

### 4. إعداد متغيرات البيئة
انسخ ملف `env.example` إلى `.env` في مجلد `server`:
```bash
cd server
cp env.example .env
```

أو أنشئ ملف `.env` يدوياً في مجلد `server`:
```env
MONGODB_URI=mongodb://localhost:27017/نظام-التأشيرات
PORT=5000
NODE_ENV=development
```

### 5. تشغيل النظام
```bash
# تشغيل الخادم والواجهة معاً
npm run dev

# أو تشغيل كل منهما منفصلاً
npm run server  # الخادم على المنفذ 5000
npm run client  # الواجهة على المنفذ 3000
```

## هيكل المشروع

```
نظام-إدارة-التأشيرات/
├── server/                 # الخادم الخلفي
│   ├── models/            # نماذج قاعدة البيانات
│   ├── routes/            # مسارات API
│   ├── uploads/           # الملفات المرفوعة
│   └── index.js           # نقطة دخول الخادم
├── client/                # الواجهة الأمامية
│   ├── src/
│   │   ├── components/    # مكونات React
│   │   ├── pages/         # صفحات التطبيق
│   │   └── App.tsx        # المكون الرئيسي
│   └── public/            # الملفات العامة
└── package.json           # إعدادات المشروع الرئيسية
```

## API Endpoints

### السكرتارية
- `GET /api/secretaries` - قائمة السكرتارية
- `POST /api/secretaries` - إضافة سكرتير جديد
- `GET /api/secretaries/:id` - تفاصيل سكرتير محدد
- `PUT /api/secretaries/:id` - تحديث السكرتير
- `DELETE /api/secretaries/:id` - حذف السكرتير

### التأشيرات
- `GET /api/visas` - قائمة التأشيرات
- `POST /api/visas` - إنشاء تأشيرة جديدة
- `GET /api/visas/:id` - تفاصيل تأشيرة محددة
- `PUT /api/visas/:id/stage-*` - إكمال مرحلة
- `POST /api/visas/:id/expenses` - إضافة مصروف
- `PUT /api/visas/:id/sell` - بيع التأشيرة
- `PUT /api/visas/:id/cancel` - إلغاء التأشيرة
- `POST /api/visas/:id/replace` - استبدال التأشيرة

### الحسابات
- `GET /api/accounts/company` - حساب الشركة
- `GET /api/accounts/secretaries` - حسابات السكرتارية
- `GET /api/accounts/summary` - ملخص مالي

### التصدير
- `GET /api/exports/visas/:status` - تصدير التأشيرات
- `GET /api/exports/secretary/:id` - تقرير السكرتير
- `GET /api/exports/company-report` - تقرير الشركة
- `GET /api/exports/expenses/:visaId` - تقرير المصروفات

## استخدام النظام

### 1. إضافة سكرتير جديد
1. انتقل إلى قسم "السكرتارية"
2. اضغط على "إضافة سكرتير"
3. أدخل الاسم والبريد الإلكتروني والهاتف
4. سيتم توليد رمز تلقائي من الاسم

### 2. إنشاء تأشيرة جديدة
1. انتقل إلى "تأشيرة جديدة"
2. أدخل جميع البيانات المطلوبة في المرحلة أ
3. اختر السكرتير المسؤول ونسبة الربح
4. ارفع مستند التأشيرة

### 3. إدارة مراحل التأشيرة
1. انتقل إلى تفاصيل التأشيرة
2. أضف المصروفات لكل مرحلة
3. أكمل كل مرحلة بالترتيب
4. عند الإكمال تصبح جاهزة للبيع

### 4. بيع التأشيرة
1. اختر تأشيرة من "المعروضة للبيع"
2. أدخل سعر البيع وبيانات العميل
3. سيتم حساب الربح والأرباح تلقائياً

### 5. التصدير والتقارير
1. استخدم أزرار التصدير في كل قسم
2. اختر نوع التقرير المطلوب
3. سيتم تحميل ملف Excel منظم

## الميزات المتقدمة

### نظام الرموز المرجعية
- كل تأشيرة لها رمز فريد: `رمز السكرتير + رقم تسلسلي`
- مثال: `AH001`, `MK002`, إلخ

### تتبع المصروفات
- مصروفات منفصلة لكل مرحلة
- إمكانية إضافة مصروفات الاستبدال
- حساب تلقائي للإجمالي

### الإلغاء التلقائي
- فحص يومي للتأشيرات المتأخرة
- إلغاء تلقائي عند تجاوز الموعد
- تحويل المصروفات كدين على السكرتير

### التقارير المالية
- إحصائيات فورية
- تقارير شهرية وسنوية
- متوسط الربح لكل تأشيرة
- تتبع أرباح الشركة والسكرتارية

## الدعم والصيانة

### النسخ الاحتياطية
```bash
# نسخ احتياطي لقاعدة البيانات
mongodump --db نظام-التأشيرات --out backup/
```

### استعادة النسخة الاحتياطية
```bash
# استعادة قاعدة البيانات
mongorestore --db نظام-التأشيرات backup/نظام-التأشيرات/
```

### تحديث النظام
```bash
# تحديث التبعيات
npm update
npm run install-all
```

## الأمان

- التحقق من صحة البيانات المدخلة
- حماية من هجمات SQL Injection
- تشفير كلمات المرور
- التحقق من أنواع الملفات المرفوعة

## المساهمة

1. Fork المشروع
2. أنشئ فرع للميزة الجديدة
3. أضف التغييرات
4. أرسل Pull Request

## الترخيص

هذا المشروع مرخص تحت رخصة MIT.

## الاتصال

للاستفسارات والدعم التقني، يرجى التواصل مع فريق التطوير.

---

**ملاحظة**: تأكد من قراءة جميع التعليمات بعناية قبل تشغيل النظام في بيئة الإنتاج. 